Studio : 원유 및 석유 제품 수출입 현황 (1)
================================================================

1998년 ~ 2018년 까지 한국석유공사의 석유수출입통계 자료를 통해

한국은 어느 국가로부터 얼마만큼의 원유를 수입하는 지 알아봅니다.

그리고

한국은 수입한 원유를 정제하여 석유제품으로 수출하고 있는데, 석유 제품의 수출과 수입양을 국가별로 실펴봅니다.

|

원 자료는 국가통계포털(`KOSIS <http://kosis.kr>`__) 의 한국석유공사의 석유수출입통계 입니다.

- 국가별 원유수입(1998 ~ 2018)
- 석유제품별 수입(1998 ~ 2018)
- 석유제품별 수출(1998 ~ 2018)


.. image:: images/oil_03.png
   :alt: oil_03 upload
   

|

원본 데이터는 1998, 1999,,, 같은 연도가 컬럼 이름으로 되어 있습니다.
이런 데이터의 형태는 분석에 적합한(tidy) 모양이 아닙니다. 즉 이 데이터에서 바로 원유 수입량이 많은 상위 국가 리스트 등을 구하거나
국가별로 데이터 분석 및 챠트를 그리기는 어렵습니다.
따라서 데이터 형태의 변환이 필요합니다.

대륙, 국가, 연도, 원유량

과 같은 컬럼으로 변환하는 작업을 RStudio 에서 reshape, plyr 의 함수를 사용하여 처리하였습니다.

-  R code 예시

.. code::

  library(reshape2)
  library(plyr)

  oil_nation <- read.table('oil_nation_1.csv', header=T, sep = "\t", row.names = NULL, 
                            fileEncoding="EUC-KR", encoding="EUC-KR")

  oil.melt <- melt(oil_nation, id.vars = c('국가별.1.', '국가별.2.'))
  colnames(oil.melt)  <- c('Continent', 'Nation', 'YEAR', 'Barrel')
  oil.melt$YEAR <- substr(oil.melt$YEAR, 2, 5)
  oil.melt$Continent <- as.character(oil.melt$Continent)
  oil.melt$Nation <- as.character(oil.melt$Nation) 


|

- 원본 데이터 (oil_nation)

.. image:: images/oil_05.png
   :alt: oil_05 upload


- 변환 후 데이터 (oil.melt)

.. image:: images/oil_06.png
   :alt: oil_06 upload

|


원유 및 석유제품 수출입 추이(1998년 ~ 2018년)
--------------------------------------------------------------------

한국이 원유(crude oil) 를 수입하는 양과 석유 제품을 수입하는 양, 수입한 원유를 정제한 후 석유 제품으로 수출하는 양의 추이입니다.

.. image:: images/oil_08.png
   :alt: oil_08 upload

1998년 ~ 2018년 원유 수입양(1000 배럴단위) 추이를 보면 약간의 주기성이 보입니다.
2002년 ~ 2003년의 원유 수입이 줄어든 것은 급격하게 경제 성장 중인 중국의 원유 수요로 인한 유가 급상승을 원인으로 추정하고 있으며,
2008년 ~ 2009년에는 2008년 미국의 금융 위기가 영향을 주었던 해입니다.
2013년 ~ 2014년에는 100달러가 넘는 고유가의 영향이 있었고,
그 이후 공급 확대 기조로 인한 유가의 안정화가 지속되어 원유 수입량이 증가하였고, 
더불어 국내 정유사를 통한 석유 제품의 수출양도 증가추세 임을 알 수 있습니다.

|

국가별 원유수입 / 석유제품 수출입 비율 : pie chart
-----------------------------------------------------------------

pie chart(원형 챠트) 로 조회한 연도별로 국가별 원유수입량, 석유제품 수출입 양의 비율을 그려보았습니다.

.. image:: images/oil_08_1.png
   :alt: oil_08_1 upload


특이한 점은 석유제품 수입국 중 미국이 2015년까지만 헤도 4 ~ 5% 비중이었는데, 2016년 부터 12.9%, 16.2%, 20.3% 로 현재는 석유제품 1위의 수입국이 되었습니다.
이는 2014년 부터 미국 셰일가스 개발로 인해 원유 수출 제한이 풀리면서 원유 수출국으로 변화하게 된 요인이 큽니다.
그리고 미국과의 정치,외교적인 관계로 인해 
미국에서 생산한 셰일 오일을 미국내에서 정제한 석유 제품으로 수입양을 늘이면서
2018년에 원유 수입은 줄어들고, 석유 제품 수입이 늘어나게 된 것으로 보입니다.

석유 제품의 수출은 지정학적으로 가까운 중국과 일본, 대만, 싱가폴, 호주 등이 큰 비중을 차지하고 있으며
중국은 급속한 경제 발전으로 인한 수요로 인해 수년동안 계속 1위의 수출 대상국입니다.

|

원유 수입국과 석유제품 수출국 sankey chart
------------------------------------------------------------------

IRIS Studio 의 보고서에는 다른 보고서를 불러올 수 있습니다.


.. image:: images/oil_09.png
   :alt: oil_09 upload


클릭하면 **DEMO_오일_sankeychart_from R**  보고서를 "한국의 원유수입국과 석유제품수출국 현황" 이라는 이름으로 팝업창으로 불러오기를 합니다.
이 보고서는 대화형 분석의 **RStudio** 에서 
2018년에 한국이 원유를 수입한 국가들과 한국이 수출하는 석유 제품의 대상 국가들을 원유량, 석유제품량으로 그린 sankey chart입니다.
from, to 와 같은 link 데이터와 node 데이터로 변환하는 과정이 필요하므로 
R 에서 변환 및 chart 까지 그린 후
이 chart 를 MINIO 로 저장하여 보고서로 URL업로드 한 것입니다.


.. image:: images/oil_10.png
   :alt: oil_10 upload








.. image:: images/seoul_pop_08.png
   :alt: gu trend 1


첫번째 챠트는 2014년 ~ 2019년의 서울시 행정구별 인구 추이 그래프로 보고서의 챠트 중 꺾은선형으로 그린 것입니다.
usecase 문서 중 `화재원인별 연간 발생 건수 추이 <http://docs.iris.tools/manual/IRIS-Usecase/usecase3-map/DEMO_map_firecenter_01.html?highlight=%EA%BA%BD%EC%9D%80%EC%84%A0%ED%98%95#id8>`__ 에 그리는 방법이 있습니다.

두번째 챠트는 조회연도인 2019년도의 행정구 인구를 많은 순서대로 `가로 막대 그래프 <http://docs.iris.tools/manual/IRIS-Tutorial/IRIS_Studio/barh/barh.html#id4>`__ 로 그린 것입니다.
콤보 박스에서 조회 연도를 선택할 수 있습니다.

세번째 챠트는 행정구별로 2014년 대비 2019년 인구가 얼마나 증가했는지, 감소했는지 가로막대로 그린 그림입니다.

|

.. image:: images/seoul_pop_09.png
   :alt: gu trend 2

이 챠트는 행정구별로 2014년 대비 2019년의 65세 이상 인구의 추이 입니다.
전체 행정구에서 65세 이상 인구는 증가하고 있음을 알 수 있습니다.

|

정리
""""""""

2014년 ~ 2019년 행정구별 인구추이를 보면 대부분의 행정구별 인구는 감소추세로 보입니다.
송파구,강서구,강남구,노원구,관악구는 인구 50만명(2019년 기준)이상의 인구를 가진 행정구이지만,
이 중 송파구, 강서구만이 인구가 plus로 증가하는 것으로 나타납니다.


서울시 행정구별로 전체 인구 대비 65세 이상 인구의 비율은 2014년 이후로 꾸준히 증가하고 있습니다.
65세 이상 인구 비율이 감소하는 행정구는 없습니다.  
인구 고령화의 큰 흐름을 서울도 크게 영향을 받고 있음을 알 수 있습니다.

다음 번에는 
서울시의 인구변화를 각 연령별로 분석해 볼 필요가 있겠습니다.






